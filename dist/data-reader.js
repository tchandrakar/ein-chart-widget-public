"use strict";class EINDataReader{constructor(t,e=0){this.sheetId=t,this.gid=e,this.csvUrl=`https://docs.google.com/spreadsheets/d/${this.sheetId}/export?format=csv&gid=${this.gid}`,this.corsProxies=["https://api.allorigins.win/raw?url=","https://corsproxy.io/?","https://cors-anywhere.herokuapp.com/"],this.maxSteps=0,this.stepSize=1,this.estimateTitleText="Estimate",this.fifthPercentileTitleText="5th Percentile",this.ninetyFifthPercentileTitleText="95th Percentile"}async fetchData(){try{const t=await fetch(this.csvUrl);if(t.ok){const e=await t.text();return this.parseCSV(e)}}catch(t){console.log("Direct access failed, trying CORS proxies...")}for(const t of this.corsProxies)try{console.log(`Trying proxy: ${t}`);const e=await fetch(t+encodeURIComponent(this.csvUrl));if(e.ok){const t=await e.text();return this.parseCSV(t)}}catch(e){console.log(`Proxy ${t} failed:`,e.message);continue}return console.warn("All data sources failed, using sample data"),this.getSampleData()}parseCSV(t){const e=t.split("\n").filter(t=>t.trim());if(e.length<2)throw new Error("CSV data appears to be empty or invalid");const i=e[0].split(",").map(t=>t.trim().replace(/"/g,"")),a=[];for(let t=1;t<e.length;t++){const n=e[t].trim();if(n){const t=this.parseCSVLine(n),e={};i.forEach((i,a)=>{e[i]=t[a]||""}),e.Date&&e.Estimate&&a.push(e)}}return a}parseCSVLine(t){const e=[];let i="",a=!1;for(let n=0;n<t.length;n++){const r=t[n],o=t[n+1];'"'===r?a&&'"'===o?(i+='"',n++):a=!a:","!==r||a?i+=r:(e.push(i.trim()),i="")}return e.push(i.trim()),e}getSampleData(){return[{Date:"1/15/2024",Estimate:"45","5th Percentile":"28","95th Percentile":"65"},{Date:"2/15/2024",Estimate:"48","5th Percentile":"32","95th Percentile":"68"},{Date:"3/15/2024",Estimate:"42","5th Percentile":"25","95th Percentile":"62"},{Date:"4/15/2024",Estimate:"38","5th Percentile":"22","95th Percentile":"58"},{Date:"5/15/2024",Estimate:"35","5th Percentile":"20","95th Percentile":"55"},{Date:"6/15/2024",Estimate:"32","5th Percentile":"18","95th Percentile":"52"},{Date:"7/15/2024",Estimate:"28","5th Percentile":"15","95th Percentile":"48"},{Date:"8/15/2024",Estimate:"25","5th Percentile":"12","95th Percentile":"42"},{Date:"9/15/2024",Estimate:"22","5th Percentile":"10","95th Percentile":"38"},{Date:"10/15/2024",Estimate:"35","5th Percentile":"20","95th Percentile":"55"},{Date:"11/15/2024",Estimate:"68","5th Percentile":"45","95th Percentile":"85"},{Date:"12/15/2024",Estimate:"52","5th Percentile":"38","95th Percentile":"74"},{Date:"1/15/2025",Estimate:"42","5th Percentile":"28","95th Percentile":"62"},{Date:"2/15/2025",Estimate:"38","5th Percentile":"25","95th Percentile":"58"},{Date:"3/15/2025",Estimate:"40","5th Percentile":"26","95th Percentile":"60"}]}processDataForChart(t){let e=new Date(0);const i=t.filter(t=>t.Date&&t.Estimate).map(t=>{let i;return i=new Date(t.Date),i>=e&&(e=i),{date:i,estimate:parseFloat(t.Estimate)||0,fifthPercentile:parseFloat(t["5th Percentile"])||0,ninetyFifthPercentile:parseFloat(t["95th Percentile"])||0}});e.setMonth(e.getMonth()-3),e.setDate(1);const a=i.filter(t=>!isNaN(t.date.getTime())&&t.date>=e).sort((t,e)=>t.date.getTime()-e.date.getTime()),n=[],r=new Set,o=[],s=[],l=[],c=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],h=[],d=new Set;a.forEach(t=>{const e=`${t.date.getDate()}-${t.date.getMonth()}-${t.date.getFullYear()}`;d.has(e)||(d.add(e),h.push(t))}),h.forEach(t=>{const e=c[t.date.getMonth()];o.push(t.estimate),s.push(t.fifthPercentile),l.push(t.ninetyFifthPercentile),this.maxSteps=Math.max(this.maxSteps,t.estimate,t.fifthPercentile,t.ninetyFifthPercentile);const i=`${e}-${t.date.getFullYear()}`;r.has(i)?n.push(""):(r.add(i),n.push(e))}),this.stepSize=Math.ceil(Math.ceil(this.maxSteps)/5+1),this.maxSteps=Math.ceil(this.maxSteps/this.stepSize)*this.stepSize;const p={pointHoverBackgroundColor:"#BEE4F7",pointHoverBorderColor:"#5FB9E6",pointHoverBorderWidth:1},m={labels:n,datasets:[{label:this.fifthPercentileTitleText,data:s,borderColor:"rgba(190, 228, 247, 0.8)",backgroundColor:"rgba(237, 249, 255, 0.3)",borderWidth:1,fill:!1,tension:.5,pointRadius:0,pointHoverRadius:0,...p,order:3},{label:this.ninetyFifthPercentileTitleText,data:l,borderColor:"rgba(190, 228, 247, 0.8)",backgroundColor:"rgba(237, 249, 255, 0.4)",borderWidth:1,fill:"-1",tension:.5,pointRadius:0,pointHoverRadius:0,...p,order:2},{label:this.estimateTitleText,data:o,borderColor:"#4A90E2",backgroundColor:"#008FD5",borderWidth:1.3,fill:!1,tension:.5,opacity:.75,pointBackgroundColor:"#008FD5",pointBorderColor:"#008FD5",pointRadius:0,pointHoverRadius:6,...p,order:1}],rawData:a};return m.rawData=h,m}initializeCustomTooltipPositioner(){const t=this.estimateTitleText,e=this.fifthPercentileTitleText,i=this.ninetyFifthPercentileTitleText,a=-10;if("undefined"!=typeof window&&window.Chart){const n=window.Chart;n.Tooltip&&n.Tooltip.positioners&&(n.Tooltip.positioners.einCustomPositioner=function(n,r){if(!n.length)return{x:r.x+0,y:r.y+a};const o=n.find(e=>void 0!==e.datasetIndex&&this.chart.data.datasets[e.datasetIndex].label===t);if(o&&void 0!==o.element.x)return{x:o.element.x+0,y:o.element.y+a};const s=n.filter(t=>{if(void 0===t.datasetIndex)return!1;const a=void 0!==t.datasetIndex&&this.chart.data.datasets[t.datasetIndex].label===e,n=void 0!==t.datasetIndex&&this.chart.data.datasets[t.datasetIndex].label===i;return a||n});if(s.length>=2){const t=s[0].element.y,e=s[1].element.y;return{x:s[0].element.x+0,y:(t+e)/2+a}}if(1===s.length)return{x:s[0].element.x+0,y:s[0].element.y+a};return{x:n.reduce((t,e)=>t+e.element.x,0)/n.length+0,y:n.reduce((t,e)=>t+e.element.y,0)/n.length+a}})}}getChartOptions(){this.initializeCustomTooltipPositioner();const t=this.estimateTitleText,e=this.fifthPercentileTitleText,i=this.ninetyFifthPercentileTitleText,a=this.maxSteps,n=this.stepSize;return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{color:"#666666",font:{size:12,family:"Arial, sans-serif"},filter:function(a){return[t,e,i].includes(a.text)},usePointStyle:!0,padding:20}},tooltip:{mode:"index",intersect:!1,position:"einCustomPositioner",backgroundColor:"rgba(255, 255, 255, 1.0)",titleColor:"#000000",bodyColor:"#000000",borderColor:"rgba(211, 210, 210, 0.8)",borderWidth:1,displayColors:!0,xAlign:"center",yAlign:"bottom",padding:12,font:{size:12,family:"Graphik"},titleMarginBottom:2,callbacks:{title:function(t){if(t.length>0){const e=t[0].chart,i=t[0].dataIndex;if(!e||!e.data)return"EIN Processing Time";const a=e.data.rawData;if(a&&a[i]){const t={year:"numeric",month:"long",day:"numeric"};return a[i].date.toLocaleDateString("en-US",t)}}return"EIN Processing Time"},label:function(){},afterBody:function(t){if(t.length>0){const e=t[0].chart,i=t[0].dataIndex;if(!e||!e.data)return[];const a=e.data.rawData;if(a&&a[i]){const t=a[i],e=Math.round(t.estimate);return[`Most people receive their EIN in ${`${Math.round(t.fifthPercentile)}-${Math.round(t.ninetyFifthPercentile)}`}`,`days, with the average being ${e} days.`]}return["Range shows typical processing time variation"]}return[]}}}},scales:{x:{display:!0,grid:{display:!1},ticks:{color:"#666666",padding:2,font:{size:12,family:"Roboto Mono"},maxRotation:0,minRotation:0,autoSkip:!1,callback:function(t){return this.getLabelForValue(t)||""}}},y:{display:!0,beginAtZero:!0,max:a,grid:{display:!1,color:"rgba(0, 0, 0, 0.1)"},ticks:{color:"#999999",padding:4,font:{size:12,family:"Roboto Mono"},stepSize:n,callback:function(t){return t>=a?"Days":null==t?String(t):t.toString()}}}},interaction:{intersect:!1,mode:"index"},elements:{point:{radius:0,hoverRadius:6},line:{tension:0}}}}}"undefined"!=typeof window&&(window.EINDataReader=EINDataReader);